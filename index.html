<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cards</title>
    <link rel="stylesheet" href="styles.css">
    <script src="jquery-1.11.1.min.js"></script>
</head>
<body>
<div id="origin">
    <div class="cardFront" id="cardFront_1">front</div>
    <div class="cardBack" id="cardBack_1">this is back</div>
    <div class="cardShadow" id="cardShadow_1"></div>
</div>
<div id="info" style="font-size: 32px"></div>


</body>

<script>   // TODO: Add PHPdoc, on window resize origin, krásný odlesky, -webkit- (safari), encapsulate whole script
    const cards = document.getElementsByClassName('card');
    const cardDimensions = {x: 0, y: 0};
    const $i = $($('#info'));

    updateCardDimensions = () => {
        cardDimensions.x = get('card_1').scrollWidth;
        cardDimensions.y = get('card_1').scrollHeight;
    }

    get = (id) => {
        return document.getElementById(id);
    }

    rndSign = () => {
        let r = Math.random();
        return r < .5 ? -1 : 1;
    }

    get('origin').style.left = window.innerWidth / 4 + 'px';
    get('origin').style.top = window.innerHeight / 4 + 'px';

    for (let card of cards) {
        let x = rndSign() * 100 * Math.random() - cardDimensions.x / 2 + 'px';
        let y = rndSign() * 100 * Math.random() - cardDimensions.y / 2 + 'px';
        card.style.left = x;
        card.style.top = y;
        get('cardShadow_1').style.left = x;
        get('cardShadow_1').style.top = y;
    }

    function openCard(e) {
        unsetClickListeners();

        // Set initial transformations before rotation
        get('cardFront_1').removeClass('rotateFrontSide');
        get('cardFront_1').removeClass('setRotated180');
        get('cardFront_1').removeClass('rotateFrontToBack');
        get('cardBack_1').removeClass('rotateBackSide');
        get('cardBack_1').removeClass('setRotated360');
        get('cardBack_1').removeClass('rotateBackToFront');

        // Rotate
        get('cardFront_1').addClass('rotateFrontSide');
        get('cardBack_1').addClass('rotateBackSide');
    }

    function closeCard(e) {
        unsetClickListeners();

        // Set initial transformations before rotation
        get('cardBack_1').addClass('setRotated360');
        get('cardBack_1').addClass('rotateBackToFront');

        // Rotate
        get('cardFront_1').addClass('setRotated180');
        get('cardFront_1').addClass('rotateFrontToBack');
    }

    // Extend HTMLElement class to simplify DOM manipulation
    HTMLElement.prototype.addClass = function(className) {
        this.classList.add(className);
    };
    HTMLElement.prototype.removeClass = function(className) {
        this.classList.remove(className);
    };

    // function animate() {
    //     requestAnimationFrame(animate);
        // $i.text($('#card_1').css('animationPlayState'));
        // $i.text($('#cardBack_1').attr('class'));
    // }
    // animate();

    setClickListeners = () => {
        get('cardFront_1').addEventListener('click', openCard);
        get('cardBack_1').addEventListener('click', closeCard);
    }

    unsetClickListeners = () => {
        get('cardFront_1').removeEventListener('click', openCard);
        get('cardBack_1').removeEventListener('click', closeCard);
    }

    setClickListeners();


    get('cardFront_1').addEventListener('webkitAnimationEnd', () => {
        setClickListeners();
    });


</script>

</html>